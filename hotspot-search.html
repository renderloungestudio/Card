<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Hotspot Search</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 8px; background: rgba(255,255,255,0.95); }
    #searchBox { width: 90%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
    #searchResults { max-height: 250px; overflow-y: auto; list-style: none; padding: 0; margin: 0; border-radius: 8px; }
    #searchResults li { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
    #searchResults li:hover { background-color: #f1f1f1; }
</style>
</head>
<body>

<input type="text" id="searchBox" placeholder="Search image hotspots...">
<ul id="searchResults"></ul>

<script>
let hotspots = [];

// STEP 1: Collect only IMAGE hotspots
function collectHotspots() {
    try {
        if (typeof pano !== "undefined" && pano.getPointHotspotIds) {
            const ids = pano.getPointHotspotIds(); // Get all hotspot IDs
            hotspots = ids.map(id => {
                const hs = pano.getHotspot(id);
                // Filter only image hotspots
                if (hs && hs.type === "image") {
                    return { id: id, name: hs.title || id };
                }
                return null;
            }).filter(Boolean); // Remove nulls
        } else {
            console.error("3DVista pano API not available. Ensure JavaScript API is enabled.");
        }
    } catch (e) {
        console.error("Error fetching hotspots:", e);
    }
}

// STEP 2: Filter hotspots based on search input
function filterHotspots() {
    const query = document.getElementById('searchBox').value.toLowerCase();
    const results = hotspots.filter(hs => hs.name.toLowerCase().includes(query));
    const list = document.getElementById('searchResults');
    list.innerHTML = '';
    results.forEach(hs => {
        const li = document.createElement('li');
        li.textContent = hs.name;
        li.onclick = () => gotoHotspot(hs.id);
        list.appendChild(li);
    });
}

// STEP 3: Jump to selected hotspot
function gotoHotspot(id) {
    try {
        const hs = pano.getHotspot(id);
        if (hs && hs.onclick) {
            hs.onclick(); // Trigger its action (show image popup, etc.)
        }
    } catch (e) {
        console.error("Error jumping to hotspot", e);
    }
}

// STEP 4: Initialize on load
window.addEventListener('load', () => {
    collectHotspots();
    document.getElementById('searchBox').addEventListener('keyup', filterHotspots);
    filterHotspots();
});
</script>

</body>
</html>
