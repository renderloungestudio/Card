<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search Image Hotspots (3D Panel)</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 8px; background: rgba(255,255,255,0.95); }
    #searchBox { width: 90%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; }
    #searchResults { max-height: 250px; overflow-y: auto; list-style: none; padding: 0; margin: 0; border-radius: 8px; }
    #searchResults li { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
    #searchResults li:hover { background-color: #f1f1f1; }
</style>
</head>
<body>

<input type="text" id="searchBox" placeholder="Search image hotspots by image name...">
<ul id="searchResults"></ul>

<script>
let imageHotspots = [];

// STEP 1: Collect Image Hotspots from 3D Panel
function collectImageHotspots() {
    try {
        if (typeof pano !== "undefined" && pano.getPointHotspotIds) {
            const ids = pano.getPointHotspotIds(); // Get all hotspot IDs in current scene
            imageHotspots = ids.map(id => {
                const hs = pano.getHotspot(id);

                // âœ… Filter only 3D Panel "image" hotspots
                if (hs && hs.type === "image") {
                    // Use image name (filename or title inside 3DVista)
                    let imageName = "";
                    if (hs.image && hs.image.src) {
                        imageName = hs.image.src.split('/').pop(); // extract file name from path
                    } else {
                        imageName = hs.title || id; // fallback if no src
                    }

                    return { id: id, name: imageName };
                }
                return null;
            }).filter(Boolean); // Remove nulls
        } else {
            console.error("3DVista pano API not available. Ensure JavaScript API is enabled.");
        }
    } catch (e) {
        console.error("Error fetching image hotspots:", e);
    }
}

// STEP 2: Filter hotspots based on search input
function filterHotspots() {
    const query = document.getElementById('searchBox').value.toLowerCase();
    const results = imageHotspots.filter(hs => hs.name.toLowerCase().includes(query));
    const list = document.getElementById('searchResults');
    list.innerHTML = '';
    results.forEach(hs => {
        const li = document.createElement('li');
        li.textContent = hs.name;
        li.onclick = () => gotoImageHotspot(hs.id);
        list.appendChild(li);
    });
}

// STEP 3: Jump to selected hotspot (activate it)
function gotoImageHotspot(id) {
    try {
        const hs = pano.getHotspot(id);
        if (hs && hs.onclick) {
            hs.onclick(); // Trigger image hotspot action (open image)
        }
    } catch (e) {
        console.error("Error activating image hotspot", e);
    }
}

// STEP 4: Initialize on load
window.addEventListener('load', () => {
    collectImageHotspots();
    document.getElementById('searchBox').addEventListener('keyup', filterHotspots);
    filterHotspots();
});
</script>

</body>
</html>
